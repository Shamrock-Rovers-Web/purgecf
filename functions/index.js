var $t=Object.defineProperty;var Nt=(e,t,r)=>t in e?$t(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var p=(e,t,r)=>(Nt(e,typeof t!="symbol"?t+"":t,r),r),Be=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)};var n=(e,t,r)=>(Be(e,t,"read from private field"),r?r.call(e):t.get(e)),d=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},u=(e,t,r,s)=>(Be(e,t,"write to private field"),s?s.call(e,r):t.set(e,r),r);var at=(e,t,r,s)=>({set _(i){u(e,t,i,r)},get _(){return n(e,t,s)}}),m=(e,t,r)=>(Be(e,t,"access private method"),r);var ct=async(e,t=Object.create(null))=>{let{all:r=!1,dot:s=!1}=t,o=(e instanceof xe?e.raw.headers:e.headers).get("Content-Type");return o?.startsWith("multipart/form-data")||o?.startsWith("application/x-www-form-urlencoded")?kt(e,{all:r,dot:s}):{}};async function kt(e,t){let r=await e.formData();return r?Ft(r,t):{}}function Ft(e,t){let r=Object.create(null);return e.forEach((s,i)=>{t.all||i.endsWith("[]")?Bt(r,i,s):r[i]=s}),t.dot&&Object.entries(r).forEach(([s,i])=>{s.includes(".")&&(Ut(r,s,i),delete r[s])}),r}var Bt=(e,t,r)=>{e[t]!==void 0?Array.isArray(e[t])?e[t].push(r):e[t]=[e[t],r]:e[t]=r},Ut=(e,t,r)=>{let s=e,i=t.split(".");i.forEach((o,c)=>{c===i.length-1?s[o]=r:((!s[o]||typeof s[o]!="object"||Array.isArray(s[o])||s[o]instanceof File)&&(s[o]=Object.create(null)),s=s[o])})};var qe=e=>{let t=e.split("/");return t[0]===""&&t.shift(),t},ht=e=>{let{groups:t,path:r}=qt(e),s=qe(r);return Wt(s,t)},qt=e=>{let t=[];return e=e.replace(/\{[^}]+\}/g,(r,s)=>{let i=`@${s}`;return t.push([i,r]),i}),{groups:t,path:e}},Wt=(e,t)=>{for(let r=t.length-1;r>=0;r--){let[s]=t[r];for(let i=e.length-1;i>=0;i--)if(e[i].includes(s)){e[i]=e[i].replace(s,t[r][1]);break}}return e},Oe={},We=e=>{if(e==="*")return"*";let t=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);return t?(Oe[e]||(t[2]?Oe[e]=[e,t[1],new RegExp("^"+t[2]+"$")]:Oe[e]=[e,t[1],!0]),Oe[e]):null},ze=(e,t)=>{try{return t(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return t(r)}catch{return r}})}},zt=e=>ze(e,decodeURI),Ke=e=>{let t=e.url,r=t.indexOf("/",8),s=r;for(;s<t.length;s++){let i=t.charCodeAt(s);if(i===37){let o=t.indexOf("?",s),c=t.slice(r,o===-1?void 0:o);return zt(c.includes("%25")?c.replace(/%25/g,"%2525"):c)}else if(i===63)break}return t.slice(r,s)};var lt=e=>{let t=Ke(e);return t.length>1&&t.at(-1)==="/"?t.slice(0,-1):t},te=(...e)=>{let t="",r=!1;for(let s of e)t.at(-1)==="/"&&(t=t.slice(0,-1),r=!0),s[0]!=="/"&&(s=`/${s}`),s==="/"&&r?t=`${t}/`:s!=="/"&&(t=`${t}${s}`),s==="/"&&t===""&&(t="/");return t},Pe=e=>{if(!e.match(/\:.+\?$/))return null;let t=e.split("/"),r=[],s="";return t.forEach(i=>{if(i!==""&&!/\:/.test(i))s+="/"+i;else if(/\:/.test(i))if(/\?/.test(i)){r.length===0&&s===""?r.push("/"):r.push(s);let o=i.replace("?","");s+="/"+o,r.push(s)}else s+="/"+i}),r.filter((i,o,c)=>c.indexOf(i)===o)},Ue=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),e.indexOf("%")!==-1?Ge(e):e):e,ut=(e,t,r)=>{let s;if(!r&&t&&!/[%+]/.test(t)){let c=e.indexOf(`?${t}`,8);for(c===-1&&(c=e.indexOf(`&${t}`,8));c!==-1;){let l=e.charCodeAt(c+t.length+1);if(l===61){let a=c+t.length+2,h=e.indexOf("&",a);return Ue(e.slice(a,h===-1?void 0:h))}else if(l==38||isNaN(l))return"";c=e.indexOf(`&${t}`,c+1)}if(s=/[%+]/.test(e),!s)return}let i={};s??(s=/[%+]/.test(e));let o=e.indexOf("?",8);for(;o!==-1;){let c=e.indexOf("&",o+1),l=e.indexOf("=",o);l>c&&c!==-1&&(l=-1);let a=e.slice(o+1,l===-1?c===-1?void 0:c:l);if(s&&(a=Ue(a)),o=c,a==="")continue;let h;l===-1?h="":(h=e.slice(l+1,c===-1?void 0:c),s&&(h=Ue(h))),r?(i[a]&&Array.isArray(i[a])||(i[a]=[]),i[a].push(h)):i[a]??(i[a]=h)}return t?i[t]:i},ft=ut,dt=(e,t)=>ut(e,t,!0),Ge=decodeURIComponent;var pt=e=>ze(e,Ge),re,A,Se,gt,je,wt,le,Ve,B,mt,xe=(mt=class{constructor(e,t="/",r=[[]]){d(this,Se);d(this,je);d(this,le);p(this,"raw");d(this,re,void 0);d(this,A,void 0);p(this,"routeIndex",0);p(this,"path");p(this,"bodyCache",{});d(this,B,e=>{let{bodyCache:t,raw:r}=this,s=t[e];if(s)return s;let i=Object.keys(t)[0];return i?t[i].then(o=>(i==="json"&&(o=JSON.stringify(o)),new Response(o)[e]())):t[e]=r[e]()});this.raw=e,this.path=t,u(this,A,r),u(this,re,{})}param(e){return e?m(this,Se,gt).call(this,e):m(this,je,wt).call(this)}query(e){return ft(this.url,e)}queries(e){return dt(this.url,e)}header(e){if(e)return this.raw.headers.get(e.toLowerCase())??void 0;let t={};return this.raw.headers.forEach((r,s)=>{t[s]=r}),t}async parseBody(e){var t;return(t=this.bodyCache).parsedBody??(t.parsedBody=await ct(this,e))}json(){return n(this,B).call(this,"json")}text(){return n(this,B).call(this,"text")}arrayBuffer(){return n(this,B).call(this,"arrayBuffer")}blob(){return n(this,B).call(this,"blob")}formData(){return n(this,B).call(this,"formData")}addValidatedData(e,t){n(this,re)[e]=t}valid(e){return n(this,re)[e]}get url(){return this.raw.url}get method(){return this.raw.method}get matchedRoutes(){return n(this,A)[0].map(([[,e]])=>e)}get routePath(){return n(this,A)[0].map(([[,e]])=>e)[this.routeIndex].path}},re=new WeakMap,A=new WeakMap,Se=new WeakSet,gt=function(e){let t=n(this,A)[0][this.routeIndex][1][e],r=m(this,le,Ve).call(this,t);return r?/\%/.test(r)?pt(r):r:void 0},je=new WeakSet,wt=function(){let e={},t=Object.keys(n(this,A)[0][this.routeIndex][1]);for(let r of t){let s=m(this,le,Ve).call(this,n(this,A)[0][this.routeIndex][1][r]);s&&typeof s=="string"&&(e[r]=/\%/.test(s)?pt(s):s)}return e},le=new WeakSet,Ve=function(e){return n(this,A)[1]?n(this,A)[1][e]:e},B=new WeakMap,mt);var yt={Stringify:1,BeforeStream:2,Stream:3},Kt=(e,t)=>{let r=new String(e);return r.isEscaped=!0,r.callbacks=t,r};var Qe=async(e,t,r,s,i)=>{typeof e=="object"&&!(e instanceof String)&&(e instanceof Promise||(e=e.toString()),e instanceof Promise&&(e=await e));let o=e.callbacks;if(!o?.length)return Promise.resolve(e);i?i[0]+=e:i=[e];let c=Promise.all(o.map(l=>l({phase:t,buffer:i,context:s}))).then(l=>Promise.all(l.filter(Boolean).map(a=>Qe(a,t,!1,s,i))).then(()=>i[0]));return r?Kt(await c,o):c};var Gt="text/plain; charset=UTF-8",Xe=(e,t={})=>{for(let r of Object.keys(t))e.set(r,t[r]);return e},ue,fe,M,G,C,E,b,L,I,de,se,ne,pe,me,O,S,Et,ge=(Et=class{constructor(e,t){d(this,O);d(this,ue,void 0);d(this,fe,void 0);p(this,"env",{});d(this,M,void 0);p(this,"finalized",!1);p(this,"error");d(this,G,200);d(this,C,void 0);d(this,E,void 0);d(this,b,void 0);d(this,L,void 0);d(this,I,!0);d(this,de,void 0);d(this,se,void 0);d(this,ne,void 0);d(this,pe,void 0);d(this,me,void 0);p(this,"render",(...e)=>(n(this,se)??u(this,se,t=>this.html(t)),n(this,se).call(this,...e)));p(this,"setLayout",e=>u(this,de,e));p(this,"getLayout",()=>n(this,de));p(this,"setRenderer",e=>{u(this,se,e)});p(this,"header",(e,t,r)=>{if(t===void 0){n(this,E)?n(this,E).delete(e):n(this,b)&&delete n(this,b)[e.toLocaleLowerCase()],this.finalized&&this.res.headers.delete(e);return}r?.append?(n(this,E)||(u(this,I,!1),u(this,E,new Headers(n(this,b))),u(this,b,{})),n(this,E).append(e,t)):n(this,E)?n(this,E).set(e,t):(n(this,b)??u(this,b,{}),n(this,b)[e.toLowerCase()]=t),this.finalized&&(r?.append?this.res.headers.append(e,t):this.res.headers.set(e,t))});p(this,"status",e=>{u(this,I,!1),u(this,G,e)});p(this,"set",(e,t)=>{n(this,M)??u(this,M,new Map),n(this,M).set(e,t)});p(this,"get",e=>n(this,M)?n(this,M).get(e):void 0);p(this,"newResponse",(...e)=>m(this,O,S).call(this,...e));p(this,"body",(e,t,r)=>typeof t=="number"?m(this,O,S).call(this,e,t,r):m(this,O,S).call(this,e,t));p(this,"text",(e,t,r)=>{if(!n(this,b)){if(n(this,I)&&!r&&!t)return new Response(e);u(this,b,{})}return n(this,b)["content-type"]=Gt,typeof t=="number"?m(this,O,S).call(this,e,t,r):m(this,O,S).call(this,e,t)});p(this,"json",(e,t,r)=>{let s=JSON.stringify(e);return n(this,b)??u(this,b,{}),n(this,b)["content-type"]="application/json",typeof t=="number"?m(this,O,S).call(this,s,t,r):m(this,O,S).call(this,s,t)});p(this,"html",(e,t,r)=>(n(this,b)??u(this,b,{}),n(this,b)["content-type"]="text/html; charset=UTF-8",typeof e=="object"?Qe(e,yt.Stringify,!1,{}).then(s=>typeof t=="number"?m(this,O,S).call(this,s,t,r):m(this,O,S).call(this,s,t)):typeof t=="number"?m(this,O,S).call(this,e,t,r):m(this,O,S).call(this,e,t)));p(this,"redirect",(e,t)=>(n(this,E)??u(this,E,new Headers),n(this,E).set("Location",String(e)),this.newResponse(null,t??302)));p(this,"notFound",()=>(n(this,ne)??u(this,ne,()=>new Response),n(this,ne).call(this,this)));u(this,ue,e),t&&(u(this,C,t.executionCtx),this.env=t.env,u(this,ne,t.notFoundHandler),u(this,me,t.path),u(this,pe,t.matchResult))}get req(){return n(this,fe)??u(this,fe,new xe(n(this,ue),n(this,me),n(this,pe))),n(this,fe)}get event(){if(n(this,C)&&"respondWith"in n(this,C))return n(this,C);throw Error("This context has no FetchEvent")}get executionCtx(){if(n(this,C))return n(this,C);throw Error("This context has no ExecutionContext")}get res(){return u(this,I,!1),n(this,L)||u(this,L,new Response("404 Not Found",{status:404}))}set res(e){if(u(this,I,!1),n(this,L)&&e)try{for(let[t,r]of n(this,L).headers.entries())if(t!=="content-type")if(t==="set-cookie"){let s=n(this,L).headers.getSetCookie();e.headers.delete("set-cookie");for(let i of s)e.headers.append("set-cookie",i)}else e.headers.set(t,r)}catch(t){if(t instanceof TypeError&&t.message.includes("immutable")){this.res=new Response(e.body,{headers:e.headers,status:e.status});return}else throw t}u(this,L,e),this.finalized=!0}get var(){return n(this,M)?Object.fromEntries(n(this,M)):{}}},ue=new WeakMap,fe=new WeakMap,M=new WeakMap,G=new WeakMap,C=new WeakMap,E=new WeakMap,b=new WeakMap,L=new WeakMap,I=new WeakMap,de=new WeakMap,se=new WeakMap,ne=new WeakMap,pe=new WeakMap,me=new WeakMap,O=new WeakSet,S=function(e,t,r){if(n(this,I)&&!r&&!t&&n(this,G)===200)return new Response(e,{headers:n(this,b)});if(t&&typeof t!="number"){let i=new Headers(t.headers);n(this,E)&&n(this,E).forEach((c,l)=>{l==="set-cookie"?i.append(l,c):i.set(l,c)});let o=Xe(i,n(this,b));return new Response(e,{headers:o,status:t.status??n(this,G)})}let s=typeof t=="number"?t:n(this,G);n(this,b)??u(this,b,{}),n(this,E)??u(this,E,new Headers),Xe(n(this,E),n(this,b)),n(this,L)&&(n(this,L).headers.forEach((i,o)=>{o==="set-cookie"?n(this,E)?.append(o,i):n(this,E)?.set(o,i)}),Xe(n(this,E),n(this,b))),r??(r={});for(let[i,o]of Object.entries(r))if(typeof o=="string")n(this,E).set(i,o);else{n(this,E).delete(i);for(let c of o)n(this,E).append(i,c)}return new Response(e,{status:s,headers:n(this,E)})},Et);var Ye=(e,t,r)=>(s,i)=>{let o=-1,c=s instanceof ge;return l(0);async function l(a){if(a<=o)throw new Error("next() called multiple times");o=a;let h,f=!1,g;if(e[a]?(g=e[a][0][0],c&&(s.req.routeIndex=a)):g=a===e.length&&i||void 0,!g)c&&s.finalized===!1&&r&&(h=await r(s));else try{h=await g(s,()=>l(a+1))}catch(w){if(w instanceof Error&&c&&t)s.error=w,h=await t(w,s),f=!0;else throw w}return h&&(s.finalized===!1||f)&&(s.res=h),s}};var R="ALL",Rt="all",bt=["get","post","put","delete","options","patch"],Ae="Can not add a route since the matcher is already built.",He=class extends Error{};var vt="__COMPOSED_HANDLER";var Vt=e=>e.text("404 Not Found",404),xt=(e,t)=>"getResponse"in e?e.getResponse():(console.error(e),t.text("Internal Server Error",500)),H,Le,Pt,$,N,V,ie,_e,oe,Te,Ot,Je=(Ot=class{constructor(e={}){d(this,Le);d(this,N);d(this,ie);d(this,oe);p(this,"get");p(this,"post");p(this,"put");p(this,"delete");p(this,"options");p(this,"patch");p(this,"all");p(this,"on");p(this,"use");p(this,"router");p(this,"getPath");p(this,"_basePath","/");d(this,H,"/");p(this,"routes",[]);d(this,$,Vt);p(this,"errorHandler",xt);p(this,"onError",e=>(this.errorHandler=e,this));p(this,"notFound",e=>(u(this,$,e),this));p(this,"fetch",(e,...t)=>m(this,oe,Te).call(this,e,t[1],t[0],e.method));p(this,"request",(e,t,r,s)=>e instanceof Request?this.fetch(t?new Request(e,t):e,r,s):(e=e.toString(),this.fetch(new Request(/^https?:\/\//.test(e)?e:`http://localhost${te("/",e)}`,t),r,s)));p(this,"fire",()=>{addEventListener("fetch",e=>{e.respondWith(m(this,oe,Te).call(this,e.request,e,void 0,e.request.method))})});[...bt,Rt].forEach(s=>{this[s]=(i,...o)=>(typeof i=="string"?u(this,H,i):m(this,N,V).call(this,s,n(this,H),i),o.forEach(c=>{m(this,N,V).call(this,s,n(this,H),c)}),this)}),this.on=(s,i,...o)=>{for(let c of[i].flat()){u(this,H,c);for(let l of[s].flat())o.map(a=>{m(this,N,V).call(this,l.toUpperCase(),n(this,H),a)})}return this},this.use=(s,...i)=>(typeof s=="string"?u(this,H,s):(u(this,H,"*"),i.unshift(s)),i.forEach(o=>{m(this,N,V).call(this,R,n(this,H),o)}),this);let r=e.strict??!0;delete e.strict,Object.assign(this,e),this.getPath=r?e.getPath??Ke:lt}route(e,t){let r=this.basePath(e);return t.routes.map(s=>{var o;let i;t.errorHandler===xt?i=s.handler:(i=async(c,l)=>(await Ye([],t.errorHandler)(c,()=>s.handler(c,l))).res,i[vt]=s.handler),m(o=r,N,V).call(o,s.method,s.path,i)}),this}basePath(e){let t=m(this,Le,Pt).call(this);return t._basePath=te(this._basePath,e),t}mount(e,t,r){let s,i;r&&(typeof r=="function"?i=r:(i=r.optionHandler,s=r.replaceRequest));let o=i?l=>{let a=i(l);return Array.isArray(a)?a:[a]}:l=>{let a;try{a=l.executionCtx}catch{}return[l.env,a]};s||(s=(()=>{let l=te(this._basePath,e),a=l==="/"?0:l.length;return h=>{let f=new URL(h.url);return f.pathname=f.pathname.slice(a)||"/",new Request(f,h)}})());let c=async(l,a)=>{let h=await t(s(l.req.raw),...o(l));if(h)return h;await a()};return m(this,N,V).call(this,R,te(e,"*"),c),this}},H=new WeakMap,Le=new WeakSet,Pt=function(){let e=new Je({router:this.router,getPath:this.getPath});return e.routes=this.routes,e},$=new WeakMap,N=new WeakSet,V=function(e,t,r){e=e.toUpperCase(),t=te(this._basePath,t);let s={path:t,method:e,handler:r};this.router.add(e,t,[r,s]),this.routes.push(s)},ie=new WeakSet,_e=function(e,t){if(e instanceof Error)return this.errorHandler(e,t);throw e},oe=new WeakSet,Te=function(e,t,r,s){if(s==="HEAD")return(async()=>new Response(null,await m(this,oe,Te).call(this,e,t,r,"GET")))();let i=this.getPath(e,{env:r}),o=this.router.match(s,i),c=new ge(e,{path:i,matchResult:o,env:r,executionCtx:t,notFoundHandler:n(this,$)});if(o[0].length===1){let a;try{a=o[0][0][0][0](c,async()=>{c.res=await n(this,$).call(this,c)})}catch(h){return m(this,ie,_e).call(this,h,c)}return a instanceof Promise?a.then(h=>h||(c.finalized?c.res:n(this,$).call(this,c))).catch(h=>m(this,ie,_e).call(this,h,c)):a??n(this,$).call(this,c)}let l=Ye(o[0],this.errorHandler,n(this,$));return(async()=>{try{let a=await l(c);if(!a.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return a.res}catch(a){return m(this,ie,_e).call(this,a,c)}})()},Ot);var De="[^/]+",we=".*",ye="(?:|/.*)",ae=Symbol(),Qt=new Set(".\\+*[^]$()");function Xt(e,t){return e.length===1?t.length===1?e<t?-1:1:-1:t.length===1||e===we||e===ye?1:t===we||t===ye?-1:e===De?1:t===De?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var Q,X,_,St,Me=(St=class{constructor(){d(this,Q,void 0);d(this,X,void 0);d(this,_,Object.create(null))}insert(e,t,r,s,i){if(e.length===0){if(n(this,Q)!==void 0)throw ae;if(i)return;u(this,Q,t);return}let[o,...c]=e,l=o==="*"?c.length===0?["","",we]:["","",De]:o==="/*"?["","",ye]:o.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/),a;if(l){let h=l[1],f=l[2]||De;if(h&&l[2]&&(f=f.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(f)))throw ae;if(a=n(this,_)[f],!a){if(Object.keys(n(this,_)).some(g=>g!==we&&g!==ye))throw ae;if(i)return;a=n(this,_)[f]=new Me,h!==""&&u(a,X,s.varIndex++)}!i&&h!==""&&r.push([h,n(a,X)])}else if(a=n(this,_)[o],!a){if(Object.keys(n(this,_)).some(h=>h.length>1&&h!==we&&h!==ye))throw ae;if(i)return;a=n(this,_)[o]=new Me}a.insert(c,t,r,s,i)}buildRegExpStr(){let t=Object.keys(n(this,_)).sort(Xt).map(r=>{let s=n(this,_)[r];return(typeof n(s,X)=="number"?`(${r})@${n(s,X)}`:Qt.has(r)?`\\${r}`:r)+s.buildRegExpStr()});return typeof n(this,Q)=="number"&&t.unshift(`#${n(this,Q)}`),t.length===0?"":t.length===1?t[0]:"(?:"+t.join("|")+")"}},Q=new WeakMap,X=new WeakMap,_=new WeakMap,St);var Ce,Ee,jt,At=(jt=class{constructor(){d(this,Ce,{varIndex:0});d(this,Ee,new Me)}insert(e,t,r){let s=[],i=[];for(let c=0;;){let l=!1;if(e=e.replace(/\{[^}]+\}/g,a=>{let h=`@\\${c}`;return i[c]=[h,a],c++,l=!0,h}),!l)break}let o=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let c=i.length-1;c>=0;c--){let[l]=i[c];for(let a=o.length-1;a>=0;a--)if(o[a].indexOf(l)!==-1){o[a]=o[a].replace(l,i[c][1]);break}}return n(this,Ee).insert(o,t,s,n(this,Ce),r),s}buildRegExp(){let e=n(this,Ee).buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0,r=[],s=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(i,o,c)=>o!==void 0?(r[++t]=Number(o),"$()"):(c!==void 0&&(s[Number(c)]=++t),"")),[new RegExp(`^${e}`),r,s]}},Ce=new WeakMap,Ee=new WeakMap,jt);var _t=[],Yt=[/^$/,[],Object.create(null)],Ie=Object.create(null);function Tt(e){return Ie[e]??(Ie[e]=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(t,r)=>r?`\\${r}`:"(?:|/.*)")}$`))}function Jt(){Ie=Object.create(null)}function Zt(e){let t=new At,r=[];if(e.length===0)return Yt;let s=e.map(h=>[!/\*|\/:/.test(h[0]),...h]).sort(([h,f],[g,w])=>h?1:g?-1:f.length-w.length),i=Object.create(null);for(let h=0,f=-1,g=s.length;h<g;h++){let[w,y,P]=s[h];w?i[y]=[P.map(([T])=>[T,Object.create(null)]),_t]:f++;let j;try{j=t.insert(y,f,w)}catch(T){throw T===ae?new He(y):T}w||(r[f]=P.map(([T,K])=>{let D=Object.create(null);for(K-=1;K>=0;K--){let[ke,be]=j[K];D[ke]=be}return[T,D]}))}let[o,c,l]=t.buildRegExp();for(let h=0,f=r.length;h<f;h++)for(let g=0,w=r[h].length;g<w;g++){let y=r[h][g]?.[1];if(!y)continue;let P=Object.keys(y);for(let j=0,T=P.length;j<T;j++)y[P[j]]=l[y[P[j]]]}let a=[];for(let h in c)a[h]=r[c[h]];return[o,a,i]}function ce(e,t){if(e){for(let r of Object.keys(e).sort((s,i)=>i.length-s.length))if(Tt(r).test(t))return[...e[r]]}}var U,q,$e,Lt,Ne,Dt,Ht,Ze=(Ht=class{constructor(){d(this,$e);d(this,Ne);p(this,"name","RegExpRouter");d(this,U,void 0);d(this,q,void 0);u(this,U,{[R]:Object.create(null)}),u(this,q,{[R]:Object.create(null)})}add(e,t,r){var l;let s=n(this,U),i=n(this,q);if(!s||!i)throw new Error(Ae);s[e]||[s,i].forEach(a=>{a[e]=Object.create(null),Object.keys(a[R]).forEach(h=>{a[e][h]=[...a[R][h]]})}),t==="/*"&&(t="*");let o=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){let a=Tt(t);e===R?Object.keys(s).forEach(h=>{var f;(f=s[h])[t]||(f[t]=ce(s[h],t)||ce(s[R],t)||[])}):(l=s[e])[t]||(l[t]=ce(s[e],t)||ce(s[R],t)||[]),Object.keys(s).forEach(h=>{(e===R||e===h)&&Object.keys(s[h]).forEach(f=>{a.test(f)&&s[h][f].push([r,o])})}),Object.keys(i).forEach(h=>{(e===R||e===h)&&Object.keys(i[h]).forEach(f=>a.test(f)&&i[h][f].push([r,o]))});return}let c=Pe(t)||[t];for(let a=0,h=c.length;a<h;a++){let f=c[a];Object.keys(i).forEach(g=>{var w;(e===R||e===g)&&((w=i[g])[f]||(w[f]=[...ce(s[g],f)||ce(s[R],f)||[]]),i[g][f].push([r,o-h+a+1]))})}}match(e,t){Jt();let r=m(this,$e,Lt).call(this);return this.match=(s,i)=>{let o=r[s]||r[R],c=o[2][i];if(c)return c;let l=i.match(o[0]);if(!l)return[[],_t];let a=l.indexOf("",1);return[o[1][a],l]},this.match(e,t)}},U=new WeakMap,q=new WeakMap,$e=new WeakSet,Lt=function(){let e=Object.create(null);return Object.keys(n(this,q)).concat(Object.keys(n(this,U))).forEach(t=>{e[t]||(e[t]=m(this,Ne,Dt).call(this,t))}),u(this,U,u(this,q,void 0)),e},Ne=new WeakSet,Dt=function(e){let t=[],r=e===R;return[n(this,U),n(this,q)].forEach(s=>{let i=s[e]?Object.keys(s[e]).map(o=>[o,s[e][o]]):[];i.length!==0?(r||(r=!0),t.push(...i)):e!==R&&t.push(...Object.keys(s[R]).map(o=>[o,s[R][o]]))}),r?Zt(t):null},Ht);var W,k,Mt,et=(Mt=class{constructor(e){p(this,"name","SmartRouter");d(this,W,[]);d(this,k,[]);u(this,W,e.routers)}add(e,t,r){if(!n(this,k))throw new Error(Ae);n(this,k).push([e,t,r])}match(e,t){if(!n(this,k))throw new Error("Fatal error");let r=n(this,W),s=n(this,k),i=r.length,o=0,c;for(;o<i;o++){let l=r[o];try{for(let a=0,h=s.length;a<h;a++)l.add(...s[a]);c=l.match(e,t)}catch(a){if(a instanceof He)continue;throw a}this.match=l.match.bind(l),u(this,W,[l]),u(this,k,void 0);break}if(o===i)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,c}get activeRouter(){if(n(this,k)||n(this,W).length!==1)throw new Error("No active router has been determined yet.");return n(this,W)[0]}},W=new WeakMap,k=new WeakMap,Mt);var Re=Object.create(null),z,v,J,he,x,F,Y,Ct,tt=(Ct=class{constructor(e,t,r){d(this,F);d(this,z,void 0);d(this,v,void 0);d(this,J,void 0);d(this,he,0);d(this,x,Re);if(u(this,v,r||Object.create(null)),u(this,z,[]),e&&t){let s=Object.create(null);s[e]={handler:t,possibleKeys:[],score:0},u(this,z,[s])}u(this,J,[])}insert(e,t,r){u(this,he,++at(this,he)._);let s=this,i=ht(t),o=[];for(let a=0,h=i.length;a<h;a++){let f=i[a];if(Object.keys(n(s,v)).includes(f)){s=n(s,v)[f];let w=We(f);w&&o.push(w[1]);continue}n(s,v)[f]=new tt;let g=We(f);g&&(n(s,J).push(g),o.push(g[1])),s=n(s,v)[f]}let c=Object.create(null),l={handler:r,possibleKeys:o.filter((a,h,f)=>f.indexOf(a)===h),score:n(this,he)};return c[e]=l,n(s,z).push(c),s}search(e,t){let r=[];u(this,x,Re);let i=[this],o=qe(t);for(let c=0,l=o.length;c<l;c++){let a=o[c],h=c===l-1,f=[];for(let g=0,w=i.length;g<w;g++){let y=i[g],P=n(y,v)[a];P&&(u(P,x,n(y,x)),h?(n(P,v)["*"]&&r.push(...m(this,F,Y).call(this,n(P,v)["*"],e,n(y,x))),r.push(...m(this,F,Y).call(this,P,e,n(y,x)))):f.push(P));for(let j=0,T=n(y,J).length;j<T;j++){let K=n(y,J)[j],D=n(y,x)===Re?{}:{...n(y,x)};if(K==="*"){let Fe=n(y,v)["*"];Fe&&(r.push(...m(this,F,Y).call(this,Fe,e,n(y,x))),f.push(Fe));continue}if(a==="")continue;let[ke,be,ve]=K,ee=n(y,v)[ke],ot=o.slice(c).join("/");if(ve instanceof RegExp&&ve.test(ot)){D[be]=ot,r.push(...m(this,F,Y).call(this,ee,e,n(y,x),D));continue}(ve===!0||ve.test(a))&&(D[be]=a,h?(r.push(...m(this,F,Y).call(this,ee,e,D,n(y,x))),n(ee,v)["*"]&&r.push(...m(this,F,Y).call(this,n(ee,v)["*"],e,D,n(y,x)))):(u(ee,x,D),f.push(ee)))}}i=f}return r.length>1&&r.sort((c,l)=>c.score-l.score),[r.map(({handler:c,params:l})=>[c,l])]}},z=new WeakMap,v=new WeakMap,J=new WeakMap,he=new WeakMap,x=new WeakMap,F=new WeakSet,Y=function(e,t,r,s){let i=[];for(let o=0,c=n(e,z).length;o<c;o++){let l=n(e,z)[o],a=l[t]||l[R],h={};if(a!==void 0&&(a.params=Object.create(null),i.push(a),r!==Re||s&&s!==Re))for(let f=0,g=a.possibleKeys.length;f<g;f++){let w=a.possibleKeys[f],y=h[a.score];a.params[w]=s?.[w]&&!y?s[w]:r[w]??s?.[w],h[a.score]=!0}}return i},Ct);var Z,It,rt=(It=class{constructor(){p(this,"name","TrieRouter");d(this,Z,void 0);u(this,Z,new tt)}add(e,t,r){let s=Pe(t);if(s){for(let i=0,o=s.length;i<o;i++)n(this,Z).insert(e,s[i],r);return}n(this,Z).insert(e,t,r)}match(e,t){return n(this,Z).search(e,t)}},Z=new WeakMap,It);var st=class extends Je{constructor(e={}){super(e),this.router=e.router??new et({routers:[new Ze,new rt]})}};var nt=()=>async e=>{let r=await e.env.ASSETS.fetch(e.req.raw);return r.status===404?e.notFound():r};var it=new st;it.get("/",nt({path:"../index.html"}));it.post("/purge",async e=>{let{zoneId:t,apiToken:r}=await e.req.json();return(await(await fetch(`https://api.cloudflare.com/client/v4/zones/${t}/purge_cache`,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({purge_everything:!0})})).json()).success?e.json({message:"Cache purged successfully"}):e.json({error:"Failed to purge cache"},400)});var As=it.fetch;export{As as onRequest};
